(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{177:function(e,t,n){},179:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(13),c=n.n(i),a=n(11),u=n(12),s=n(34),l=n(33),h=n(35),d=n(8),f=function(){var e=new TextEncoder("utf-8"),t=new TextDecoder("utf-8");return function(){function n(){Object(a.a)(this,n),this.device=null,this.server=null,this._characteristics=new Map,this._debug=!1,this._connected=!1}return Object(u.a)(n,[{key:"isConnected",value:function(){return this.device&&this.device.gatt.connected&&this._connected}},{key:"connect",value:function(e,t){var n=this;return navigator.bluetooth.requestDevice(e).then(function(e){return n.device=e,n._log('Connected to device named "'+e.name+'" with ID "'+e.id+'"'),e.gatt.connect()}).then(function(e){return n.server=e,Promise.all(Object.keys(t).map(function(r){return e.getPrimaryService(r).then(function(e){return Promise.all(Object.keys(t[r].characteristics).map(function(t){return n._cacheCharacteristic(e,t).then(function(){n._log('Found characteristic "'+t+'"')}).catch(function(e){n._error('Characteristic "'+t+'" NOT found')})})).then(function(){return n._connected=!0})}).then(function(){n._log('Found service "'+r+'"')}).catch(function(e){n._error('Service "'+r+'"')})}))})}},{key:"disconnect",value:function(){var e=this;return new Promise(function(t,n){e.isConnected()?t():n("Device not connected")}).then(function(){return e._log("Device disconnected"),e._connected=!1,e.device.gatt.disconnect()}).catch(function(t){e._error(t)})}},{key:"readCharacteristicValue",value:function(e){var t=this;return new Promise(function(e,n){t.isConnected()?e():n("Device not connected")}).then(function(){var n=t._characteristics.get(e);return n.readValue().then(function(e){return e=e.buffer?e:new DataView(e),t._log("READ",n.uuid,e),e})}).catch(function(e){t._error(e)})}},{key:"writeCharacteristicValue",value:function(e,t){var n=this;return new Promise(function(e,t){n.isConnected()?e():t("Device not connected")}).then(function(){var r=n._characteristics.get(e);return n._log("WRITE",r.uuid,t),r.writeValue(t)}).catch(function(e){n._error(e)})}},{key:"_error",value:function(e){if(!this._debug)throw e;console.debug(e)}},{key:"_log",value:function(e){this._debug&&console.log(e)}},{key:"_cacheCharacteristic",value:function(e,t){var n=this;return e.getCharacteristic(t).then(function(e){n._characteristics.set(t,e)})}},{key:"_decodeString",value:function(e){return t.decode(e)}},{key:"_encodeString",value:function(t){return e.encode(t)}}]),n}()}(),v=n(66),p=n.n(v),b=function(){var e=0,t=15,n=8,r=[{portId:0,channelsId:[0,1]},{portId:1,channelsId:[2,3]},{portId:2,channelsId:[4,5]},{portId:3,channelsId:[6,7]}],o="output",i=0,c=1,s=0,l=255;return function(){function h(e){Object(a.a)(this,h),this.webbluetooth=new f,this.NAME=e||"",this.PORT0=this.TOPLEFT=r[0].portId,this.PORT1=this.BOTTOMLEFT=r[1].portId,this.PORT2=this.TOPRIGHT=r[2].portId,this.PORT3=this.BOTTOMRIGHT=r[3].portId,this.CW=i,this.CCW=c,this.MAX=l,this.SERVICES={},this.keepalive=null,this.ports=[{power:s,direction:i,mode:o,busy:!1},{power:s,direction:i,mode:o,busy:!1},{power:s,direction:i,mode:o,busy:!1},{power:s,direction:i,mode:o,busy:!1}],this.maxConcurrent=1,this.maxQueue=1/0,this.queue=new p.a(this.maxConcurrent,this.maxQueue),this._debug=!1,this.MIN="288"}return Object(u.a)(h,[{key:"connect",value:function(e){var t,n,r,o=this;this.SERVICES=(r={},Object(d.a)(r,"device_information",{name:"Device Information",characteristics:(t={},Object(d.a)(t,"model_number_string",{name:"Model Number String"}),Object(d.a)(t,"firmware_revision_string",{name:"Firmware Revision String"}),Object(d.a)(t,"hardware_revision_string",{name:"Hardware Revision String"}),Object(d.a)(t,"software_revision_string",{name:"Software Revision String"}),Object(d.a)(t,"manufacturer_name_string",{name:"Manufacturer Name String"}),t)}),Object(d.a)(r,"4dc591b0-857c-41de-b5f1-15abda665b0c",{name:"Remote Control",characteristics:(n={},Object(d.a)(n,"02b8cbcc-0e25-4bda-8790-a15f53e6010f",{name:"Quick Drive"}),Object(d.a)(n,"489a6ae0-c1ab-4c9c-bdb2-11d373c1b7fb",{name:"Remote Control"}),n)}),r);var i={optionalServices:Object.keys(this.SERVICES)};return""!=this.NAME?i.filters=[{namePrefix:[this.NAME]}]:i.acceptAllDevices=!0,this.webbluetooth.connect(i,this.SERVICES).then(function(){e(!0),o.isConnected()&&(o._debug&&o._log("Connected to SBrick "+o.webbluetooth.device.id),o.getFirmwareVersion().then(function(t){parseFloat(t)>=4.17?o.keepalive=o._keepalive(o):(o._error("Firmware not compatible: please update your SBrick."),o.disconnect(),e(!1))}))}).catch(function(e){o._error(e)})}},{key:"disconnect",value:function(e){var t=this;return new Promise(function(e,n){t.isConnected()?e():n("Not connected")}).then(function(){return t.stopAll().then(function(){return clearInterval(t.keepalive),e(!1),t.webbluetooth.disconnect()})}).catch(function(e){t._error(e)})}},{key:"isConnected",value:function(){return this.webbluetooth&&this.webbluetooth.isConnected()}},{key:"getModelNumber",value:function(){return this._deviceInfo("model_number_string")}},{key:"getFirmwareVersion",value:function(){return this._deviceInfo("firmware_revision_string")}},{key:"getHardwareVersion",value:function(){return this._deviceInfo("hardware_revision_string")}},{key:"getSoftwareVersion",value:function(){return this._deviceInfo("software_revision_string")}},{key:"getManufacturerName",value:function(){return this._deviceInfo("manufacturer_name_string")}},{key:"drive",value:function(e){var t=this;"object"!==typeof e&&(e={portId:arguments[0],direction:arguments[1],power:arguments[2]},this._log("Calling drive with 3 arguments is deprecated: use 1 object {portId, direction, power} instead."));var n=e.portId,a=e.direction||i,u=void 0===e.power?l:e.power;return new Promise(function(e,t){if(void 0!==n&&void 0!==a&&void 0!==u)e();else{var r="Wrong input: please specify ";void 0===n&&(r+="portId"),void 0===u&&(void 0===n&&(r+=" and"),r+=" power"),t(r)}}).then(function(){return t._pvm({portId:n,mode:o})}).then(function(){var e=t.ports[n];e.power=Math.min(Math.max(parseInt(Math.abs(u)),s),l),e.direction=a?c:i,e.busy||(e.busy=!0,t.queue.add(function(){return e.busy=!1,t.webbluetooth.writeCharacteristicValue("02b8cbcc-0e25-4bda-8790-a15f53e6010f",new Uint8Array([1,r[n].portId,e.direction,e.power]))}))}).then(function(){var e=t._getPortData(n);return t._sendPortChangeEvent(e),e}).catch(function(e){t._error(e)})}},{key:"quickDrive",value:function(e){var t=this;return new Promise(function(t,n){Array.isArray(e)?t():n("Wrong input: quickDrive expects array")}).then(function(){var e=[];return t._getPorts().forEach(function(t){e.push({portId:t,mode:o})}),console.log(e),t._pvm(e)}).then(function(){e.forEach(function(e){var n=parseInt(e.portId);isNaN(n)&&(n=parseInt(e.port),t._log("object property port is deprecated. use portId instead."));var r=t.ports[n];r.power=Math.min(Math.max(parseInt(Math.abs(e.power)),s),l),r.direction=e.direction?c:i}),t._portsIdle(t._getPorts())&&(t._setPortsBusy(t._getPorts(),!0),t.queue.add(function(){var e=[];return t.ports.forEach(function(t,n){t.busy=!1,e.push(parseInt(parseInt(t.power/l*127).toString(2)+t.direction,2))}),t.webbluetooth.writeCharacteristicValue("489a6ae0-c1ab-4c9c-bdb2-11d373c1b7fb",new Uint8Array(e))}))}).then(function(){var n=[];return e.forEach(function(e){var r=e.portId;e.port&&(r=parseInt(e.port));var o=t._getPortData(r);t._sendPortChangeEvent(o),n.push(o)}),n}).catch(function(e){t._error(e)})}},{key:"stop",value:function(t){var n=this;return new Promise(function(e,n){null!==t?(Array.isArray(t)||(t=[t]),e()):n("wrong input")}).then(function(){var e=[];return t.forEach(function(t){e.push({portId:t,mode:"break"})}),n._pvm(e)}).then(function(){var r=[];t.forEach(function(e){var t=n.ports[e];t.power=0,t.busy||r.push(e)}),r.length&&(n._setPortsBusy(r,!0),n.queue.add(function(){return n._setPortsBusy(r,!1),n.webbluetooth.writeCharacteristicValue("02b8cbcc-0e25-4bda-8790-a15f53e6010f",new Uint8Array([e].concat(r)))}))}).then(function(){var e=[];return t.forEach(function(t){var r=n._getPortData(t);n._sendPortChangeEvent(r),e.push(r)}),e}).catch(function(e){n._error(e)})}},{key:"stopAll",value:function(){return this.stop(this._getPorts())}},{key:"getBattery",value:function(){return this._volt().then(function(e){return parseInt(Math.abs(e/9*100))})}},{key:"getTemp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._temp().then(function(t){return e?9*t/5+32:t})}},{key:"getSensor",value:function(e,t){var r=this;return new Promise(function(t,n){null!==e?t():n("wrong input")}).then(function(){var t={portId:e,mode:"input"};return"break"===r.ports[e].mode||0!=r.ports[e].power?r.drive(e,i,0).then(function(){return r._pvm(t)}):r._pvm(t)}).then(function(){var o=r._getPortChannels(e);return r._adc([n].concat(o)).then(function(e){for(var n=[],r=0;r<e.byteLength;r+=2)n.push(e.getUint16(r,!0));var o={type:"unknown",voltage:n[0]>>4,ch0_raw:n[1]>>4,ch1_raw:n[2]>>4};switch(t){case"wedo":var i=Math.round(o.ch0_raw/o.voltage*255),c=Math.round(o.ch1_raw/o.voltage*255);o.type=i>=48&&i<=50?"tilt":"motion",o.value=c;break;default:o.value=o.ch1_raw/o.voltage}return o})})}},{key:"invDir",value:function(e){return e?i:c}},{key:"_deviceInfo",value:function(e){var t=this;return new Promise(function(n,r){"undefined"!=typeof t.SERVICES.device_information.characteristics[e]?n():r("Wrong input")}).then(function(){return t.webbluetooth.readCharacteristicValue(e).then(function(e){for(var t="",n=0;n<e.byteLength;n++)t+=String.fromCharCode(e.getUint8(n));return t}).catch(function(e){t._error(e)})}).catch(function(e){t._error(e)})}},{key:"_keepalive",value:function(){var e=this;return setInterval(function(){e.isConnected()?0===e.queue.getQueueLength()&&e.queue.add(function(){return e.webbluetooth.writeCharacteristicValue("02b8cbcc-0e25-4bda-8790-a15f53e6010f",new Uint8Array([t,9]))}):(e._log("Connection lost"),clearInterval(e.keepalive))},300)}},{key:"_adc",value:function(e){var n=this;return this.queue.add(function(){var r=Array.isArray(e)?e:[e];return n.webbluetooth.writeCharacteristicValue("02b8cbcc-0e25-4bda-8790-a15f53e6010f",new Uint8Array([t].concat(r))).then(function(){return n.webbluetooth.readCharacteristicValue("02b8cbcc-0e25-4bda-8790-a15f53e6010f").then(function(e){return e})})})}},{key:"_pvm",value:function(e){var t=this;return new Promise(function(t,n){null!==e?t():n("wrong input")}).then(function(){Array.isArray(e)||(e=[e]);var n=!1;if(e.forEach(function(e){var r=e.portId,o=e.mode;t.ports[r].mode!=o&&(t.ports[r].mode=o,n=!0)}),n){var r=[44],o="";return t.ports.forEach(function(e,n){if("input"==e.mode){var i=t._getPortChannels(n);r.push(i[0]),r.push(i[1]),o+=" PORT"+n+" (CH"+i[0]+" CH"+i[1]+")"}}),t.queue.add(function(){return t.webbluetooth.writeCharacteristicValue("02b8cbcc-0e25-4bda-8790-a15f53e6010f",new Uint8Array(r)).then(function(){t._log("PVM set"+(""==o?" OFF":o))})}),t._delay(500)}return!1})}},{key:"_volt",value:function(){return this._adc(n).then(function(e){var t=e.getInt16(0,!0);return parseFloat(.83875*t/2047)})}},{key:"_temp",value:function(){return this._adc(9).then(function(e){var t=e.getInt16(0,!0);return parseFloat(t/118.85795-160)})}},{key:"_getPorts",value:function(){return r.map(function(e){return e.portId})}},{key:"_getPortChannels",value:function(e){return r[e].channelsId}},{key:"_getPortData",value:function(e){var t=this.ports[e];return{portId:e,direction:t.direction,power:t.power,mode:t.mode}}},{key:"_error",value:function(e){if(!this._debug)throw e;console.debug(e)}},{key:"_log",value:function(e){this._debug&&console.log(e)}},{key:"_delay",value:function(e){return new Promise(function(t){setTimeout(t,e)})}},{key:"_sendPortChangeEvent",value:function(e){var t=new CustomEvent("portchange.sbrick",{detail:e});document.body.dispatchEvent(t)}},{key:"_portsIdle",value:function(e){var t=this,n=!0;return e.forEach(function(e){t.ports[e].busy&&(n=!1)}),n}},{key:"_setPortsBusy",value:function(e,t){var n=this;e.forEach(function(e){n.ports[e].busy=t})}}]),h}()}(),g=n(45),m=n(6),w=n(7),_=n(44),k=n.n(_),y=n(70),C=n.n(y);function E(){var e=Object(m.a)(["\n  && {\n      color: ",";\n      width: 45px;\n      height: 55px;\n      position: relative;\n      left: 15%;\n      top: 5%;\n      background-color: white;\n  }\n"]);return E=function(){return e},e}function I(){var e=Object(m.a)(["\n  && {\n    margin: 30px;\n    color: white;\n  }\n"]);return I=function(){return e},e}function O(){var e=Object(m.a)(["\n  && {\n    margin: 30px;\n    color: ",";\n  }\n"]);return O=function(){return e},e}function x(){var e=Object(m.a)(["\n  color: white;\n  text-align: center;\n  font-size: 3vw;\n  letter-spacing: .1em;\n  font-family:  'Lato', san-serif;\n"]);return x=function(){return e},e}function S(){var e=Object(m.a)(["\n  width: 100vw;\n  height: 100%;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n"]);return S=function(){return e},e}function j(){var e=Object(m.a)(["\n  width: 100vw;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n"]);return j=function(){return e},e}function P(){var e=Object(m.a)(["\n  height: 100vh;\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n  flex-direction: column;\n"]);return P=function(){return e},e}var F=w.a.div(P()),V=w.a.div(j()),M=w.a.div(S()),R=w.a.h3(x()),A=Object(w.a)(function(e){e.connected;var t=Object(g.a)(e,["connected"]);return o.a.createElement(k.a,t)})(O(),function(e){return e.connected?"#8db945":"white"}),T=Object(w.a)(k.a)(I()),B=Object(w.a)(function(e){e.lights;var t=Object(g.a)(e,["lights"]);return o.a.createElement(C.a,t)})(E(),function(e){return e.lights?"#8db945":"black"});function D(){var e=Object(m.a)(["\n  width: 100%;\n  boxShadow: inset 0px 1px 3px rgba(0, 0, 0, 0.3);\n  display: flex;\n  justify-content: center;\n  border: none;\n  transform: rotate(-90deg);\n  background: transparent;\n  font-size: 1em;\n  cursor: pointer;\n  -webkit-appearance: none;\n  background: transparent;\n\n    &:focus {\n      outline: none;\n    }\n\n    &::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      border: 1px solid #000000;\n      height: 56px;\n      width: 56px;\n      border-radius: 50%;\n      background: #ffffff;\n      cursor: pointer;\n      margin-top: -14px;\n      box-shadow: 0px 1px 3px #000000, 0px 0px 0px #0d0d0d;\n    }\n\n    &::-webkit-slider-runnable-track {\n      height: 30px;\n      cursor: pointer;\n      box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;\n      background: grey;\n      border-radius: 10px;\n      border: 0.4px solid #010101;\n\n    }\n  \n"]);return D=function(){return e},e}function q(){var e=Object(m.a)(["\n  width: 150px;\n  height: 150px;\n  display: flex;\n  justify-content: center;\n"]);return q=function(){return e},e}var N=w.a.div(q()),L=w.a.input(D()),U=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(s.a)(this,Object(l.a)(t).call(this,e))).handleOnChange=function(e){var t=n.props.sbrick,r=t.PORT1,o=t.PORT3,i=t.CW,c=t.CCW,a=n.props.left?o:r,u=n.props.left?e.target.value<0?i:c:e.target.value<0?c:i;n.setState({value:e.target.value}),n.props.sbrick.drive(a,u,e.target.value)},n.setSbrickDriveValue=function(e){var t=n.props.sbrick,r=t.PORT1,o=t.PORT3,i=t.CW,c=n.props.left?o:r;n.setState({value:e}),n.props.sbrick.drive(c,i,e)},n.state={value:0,type:n.props.type},n.MIN_VALUE="-255",n.MAX_VALUE="255",n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(N,null,o.a.createElement(L,{name:"controller",type:"range",min:this.MIN_VALUE,max:this.MAX_VALUE,value:this.state.value,onChange:this.handleOnChange,onTouchEnd:function(){e.setSbrickDriveValue(0)},onMouseUp:function(){e.setSbrickDriveValue(0)}}))}}]),t}(o.a.Component),W=n(72),z=n.n(W),H=n(71),Q=n.n(H),X=n(74),G=n.n(X),J=n(73),$=n.n(J),K=n(75),Y=n.n(K);function Z(e){return e?void(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()):function(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}()}var ee=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(s.a)(this,Object(l.a)(t).call(this,e))).setConnect=function(e){n.setState({connected:e})},n.getBluetoothButton=function(){return n.state.connected?o.a.createElement(Q.a,null):o.a.createElement(z.a,null)},n.getFullScrennButton=function(){return n.state.fullScreen?o.a.createElement($.a,null):o.a.createElement(G.a,null)},n.handleBluetoothButtonClick=function(){n.state.connected?n.state.sbrick.disconnect(n.setConnect):n.state.sbrick.connect(n.setConnect)},n.handleFullScreenButtonClick=function(){Z(n.state.fullScreen),n.setState({fullScreen:!n.state.fullScreen})},n.handleLightsButtonClick=function(){var e=n.state.lights?0:255;n.state.sbrick.drive(0,n.state.sbrick.CW,e),n.setState({lights:!n.state.lights})},n.state={connected:!1,fullScreen:!1,lights:!1,leftMotor:0,rightMotor:0,sbrick:new b},n}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(F,null,o.a.createElement(V,null,o.a.createElement(A,{connected:this.state.connected,onClick:function(){return e.handleBluetoothButtonClick()}},this.getBluetoothButton()),o.a.createElement(R,null,"Lego Controller"),o.a.createElement(T,{onClick:function(){return e.handleFullScreenButtonClick()}},this.getFullScrennButton())),o.a.createElement(B,{lights:this.state.lights,onClick:function(){return e.handleLightsButtonClick()}},o.a.createElement(Y.a,{fontSize:"small"})),o.a.createElement(M,null,o.a.createElement(U,{sbrick:this.state.sbrick,left:!0}),o.a.createElement(U,{sbrick:this.state.sbrick,right:!0})))}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(177);c.a.render(o.a.createElement(ee,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},77:function(e,t,n){e.exports=n(179)}},[[77,2,1]]]);
//# sourceMappingURL=main.c41aa688.chunk.js.map